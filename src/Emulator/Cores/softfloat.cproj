<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <UsingTask AssemblyFile="$(MSBuildProjectDirectory)/../../../../../lib/cctask/CCTask/bin/Release/CCTask.dll" TaskName="CCompilerTask"/>

  <PropertyGroup>
    <Architecture Condition=" $(Architecture) == '' ">i386</Architecture>
    <SoftFloatDirectory>tlib/softfloat-3</SoftFloatDirectory>
    <BuildDirectory>$(SoftFloatDirectory)/build/$(Configuration)</BuildDirectory>
    <OutputDirectory>$(BuildDirectory)</OutputDirectory>
  </PropertyGroup>

  <Target Name="_VerifyProperties">
    <Error Text="No configuration provided" Condition=" $(Configuration) == '' "/>
    <PropertyGroup>
      <SoftFloatOutput>$(OutputDirectory)/libsoftfloat.a</SoftFloatOutput>
      <ObjectFilesDirectory>$(BuildDirectory)</ObjectFilesDirectory>
    </PropertyGroup>

    <ItemGroup>
      <CompilationFlags Include="-Werror-implicit-function-declaration" />
      <CompilationFlags Include="-DSOFTFLOAT_ROUND_ODD" />
      <CompilationFlags Include="-DSOFTFLOAT_FAST_INT64" />
      <CompilationFlags Include="-DINLINE_LEVEL=5" Condition="$(Configuration) == 'Release'" />
      <CompilationFlags Include="-DSOFTFLOAT_FAST_DIV32TO16" />
      <CompilationFlags Include="-DSOFTFLOAT_FAST_DIV64TO32" />
      <CompilationFlags Include="-I $(SoftFloatDirectory)/build/Linux-x86_64-GCC" />
      <CompilationFlags Include="-I $(SoftFloatDirectory)/source/8086-SSE" />
      <CompilationFlags Include="-I $(SoftFloatDirectory)/source/include " />
      <CompilationFlags Include="-fomit-frame-pointer" Condition="$(Configuration) == 'Release' and $(TlibProfilingBuild) != 'true'" />
      <CompilationFlags Include="-fno-omit-frame-pointer" Condition="$(TlibProfilingBuild) == 'true'" />
      <CompilationFlags Include="-O3" Condition="$(Configuration) == 'Release'" />
      <CompilationFlags Include="-fPIC " Condition=" $(CurrentPlatform) != 'Windows'" />
      <CompilationFlags Include="-g3 " Condition=" $(Configuration) == 'Debug' or $(TlibProfilingBuild) == 'true'" />

      <CSources Include="$(SoftFloatDirectory)/source/*.c" Exclude="$(SoftFloatDirectory)/source/s_*.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_eq128.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_le128.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_lt128.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_shortShiftLeft128.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_shortShiftRight128.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_shortShiftRightJam64.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_shortShiftRightJam64Extra.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_shortShiftRightJam128.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_shortShiftRightJam128Extra.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_shiftRightJam32.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_shiftRightJam64.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_shiftRightJam64Extra.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_shiftRightJam128.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_shiftRightJam128Extra.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_shiftRightJam256M.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_countLeadingZeros8.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_countLeadingZeros16.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_countLeadingZeros32.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_countLeadingZeros64.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_add128.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_add256M.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_sub128.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_sub256M.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_mul64ByShifted32To128.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_mul64To128.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_mul128By32.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_mul128To256M.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_approxRecip_1Ks.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_approxRecip32_1.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_approxRecipSqrt_1Ks.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_approxRecipSqrt32_1.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_roundToUI32.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_roundToUI64.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_roundToI32.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_roundToI64.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_normSubnormalF16Sig.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_roundPackToF16.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_normRoundPackToF16.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_addMagsF16.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_subMagsF16.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_mulAddF16.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_normSubnormalF32Sig.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_roundPackToF32.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_normRoundPackToF32.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_addMagsF32.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_subMagsF32.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_mulAddF32.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_normSubnormalF64Sig.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_roundPackToF64.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_normRoundPackToF64.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_addMagsF64.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_subMagsF64.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_mulAddF64.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_normSubnormalExtF80Sig.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_roundPackToExtF80.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_normRoundPackToExtF80.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_addMagsExtF80.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_subMagsExtF80.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_normSubnormalF128Sig.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_roundPackToF128.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_normRoundPackToF128.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_addMagsF128.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_subMagsF128.c" />
      <CSources Include="$(SoftFloatDirectory)/source/s_mulAddF128.c" />
  
      <CSources Include="$(SoftFloatDirectory)/source/8086-SSE/softfloat_raiseFlags.c" />
      <CSources Include="$(SoftFloatDirectory)/source/8086-SSE/s_f16UIToCommonNaN.c" />
      <CSources Include="$(SoftFloatDirectory)/source/8086-SSE/s_commonNaNToF16UI.c" />
      <CSources Include="$(SoftFloatDirectory)/source/8086-SSE/s_propagateNaNF16UI.c" />
      <CSources Include="$(SoftFloatDirectory)/source/8086-SSE/s_f32UIToCommonNaN.c" />
      <CSources Include="$(SoftFloatDirectory)/source/8086-SSE/s_commonNaNToF32UI.c" />
      <CSources Include="$(SoftFloatDirectory)/source/8086-SSE/s_propagateNaNF32UI.c" />
      <CSources Include="$(SoftFloatDirectory)/source/8086-SSE/s_f64UIToCommonNaN.c" />
      <CSources Include="$(SoftFloatDirectory)/source/8086-SSE/s_commonNaNToF64UI.c" />
      <CSources Include="$(SoftFloatDirectory)/source/8086-SSE/s_propagateNaNF64UI.c" />
      <CSources Include="$(SoftFloatDirectory)/source/8086-SSE/extF80M_isSignalingNaN.c" />
      <CSources Include="$(SoftFloatDirectory)/source/8086-SSE/s_extF80UIToCommonNaN.c" />
      <CSources Include="$(SoftFloatDirectory)/source/8086-SSE/s_commonNaNToExtF80UI.c" />
      <CSources Include="$(SoftFloatDirectory)/source/8086-SSE/s_propagateNaNExtF80UI.c" />
      <CSources Include="$(SoftFloatDirectory)/source/8086-SSE/f128M_isSignalingNaN.c" />
      <CSources Include="$(SoftFloatDirectory)/source/8086-SSE/s_f128UIToCommonNaN.c" />
      <CSources Include="$(SoftFloatDirectory)/source/8086-SSE/s_commonNaNToF128UI.c" />
      <CSources Include="$(SoftFloatDirectory)/source/8086-SSE/s_propagateNaNF128UI.c" />
      
      <InputFiles Include="$(SoftFloatDirectory)/**" Exclude="$(BuildDirectory)/**;$(OutputDirectory)/*.a" />
    </ItemGroup>

    <ItemGroup>
      <ObjectFiles Include="@(CSources -> '$(ObjectFilesDirectory)/%(relativedir)%(filename).o')" />
    </ItemGroup>
  </Target>

  <Target Name="Compile" Inputs="@(InputFiles)" Outputs="@(ObjectFiles)" DependsOnTargets="_VerifyProperties">
    <CCompilerTask CompilerPath="$(CompilerPath)" Parallel="true" Sources="@(CSources)" Flags="@(CompilationFlags)" ObjectFilesDirectory="$(ObjectFilesDirectory)"/>
  </Target>

  <Target Name="Build" Inputs="@(ObjectFiles)" Outputs="$(SoftFloatOutput)" DependsOnTargets="Compile">
    <Message Text="Calling ar"/>
    <PropertyGroup>
      <ObjectFilesString>@(ObjectFiles->'%(Identity)', ' ')</ObjectFilesString>
    </PropertyGroup>
    <MakeDir Directories="$(OutputDirectory)"/>
    <Exec Command="$(ArPath) rcs $(SoftFloatOutput) $(ObjectFilesString)" Condition=" !Exists('$(SoftFloatOutput)') Or '$(ObjectFilesString)' != '' "/>
  </Target>

  <Target Name="Clean">
    <RemoveDir Directories="$(BuildDirectory);$(OutputDirectory)"/>
  </Target>
</Project>
